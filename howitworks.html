<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<title data-react-helmet="true">How it works | Semaphore Documentation</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://akinovak.github.io/semaphore-spec/howitworks"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="How it works | Semaphore Documentation"><meta data-react-helmet="true" name="description" content="Inserting identities"><meta data-react-helmet="true" property="og:description" content="Inserting identities"><link data-react-helmet="true" rel="shortcut icon" href="/semaphore-spec/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://akinovak.github.io/semaphore-spec/howitworks"><link data-react-helmet="true" rel="alternate" href="https://akinovak.github.io/semaphore-spec/howitworks" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://akinovak.github.io/semaphore-spec/howitworks" hreflang="x-default"><link rel="stylesheet" href="/semaphore-spec/assets/css/styles.796fd605.css">
<link rel="preload" href="/semaphore-spec/assets/js/runtime~main.87f30fe4.js" as="script">
<link rel="preload" href="/semaphore-spec/assets/js/main.4ce3ad23.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/semaphore-spec/"><b class="navbar__title">Semaphore</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/appliedzkp/semaphore" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/semaphore-spec/">Introduction</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/semaphore-spec/howitworks">How it works</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/semaphore-spec/quickstart">Quick start</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/semaphore-spec/usage">Usage</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/semaphore-spec/contract-api">Contract API</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/semaphore-spec/libsemaphore">libsemaphore</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/semaphore-spec/trustedsetup">Multi-party trusted setup</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/semaphore-spec/audit">Security audit</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/semaphore-spec/creditsandresources">Credits</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/semaphore-spec/code-of-conduct">Code of conduct</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/semaphore-spec/contributing">Contributing</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/semaphore-spec/references">References</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>How it works</h1></header><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="inserting-identities"></a>Inserting identities<a class="hash-link" href="#inserting-identities" title="Direct link to heading">#</a></h2><p>An identity is comprised of the following information:</p><ol><li>An <a href="https://en.wikipedia.org/wiki/EdDSA" target="_blank" rel="noopener noreferrer">EdDSA</a> private key. Note that it is
<em>not</em> an Ethereum private key.</li><li>An identity nullifier, whih is a random 32-byte value.</li><li>An identity trapdoor, whih is a random 32-byte value.</li></ol><p>An identity commitment is the Pedersen hash of:</p><ol><li>The public key associated with the identity&#x27;s private key.</li><li>The identity nullifier.</li><li>The identity trapdoor.</li></ol><p>To register an identity, the user must insert their identity commitment into
Semaphore&#x27;s identity tree. They can do this by calling the Semaphore contract&#x27;s
<code>insertIdentity(uint256 _identityCommitment)</code> function. See the <a href="/semaphore-spec/contract-api">API
reference</a> for more information.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="broadcasting-signals"></a>Broadcasting signals<a class="hash-link" href="#broadcasting-signals" title="Direct link to heading">#</a></h2><p>To broadcast a signal, the user must invoke this Semaphore contract function:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">broadcastSignal(</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    bytes memory _signal,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint256[8] memory _proof,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint256 _root,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint256 _nullifiersHash,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint232 _externalNullifier</span></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li><code>_signal</code>: the signal to broadcast.</li><li><code>_proof</code>: a zk-SNARK proof (see below).</li><li><code>_root</code>: The root of the identity tree, where the user&#x27;s identity commitment
is the last-inserted leaf.</li><li><code>_nullifiersHash</code>: A uniquely derived hash of the external nullifier, user&#x27;s
identity nullifier, and the Merkle path index to their identity commitment.
It ensures that a user cannot broadcast a signal with the same external
nullifier more than once.</li><li><code>_externalNullifier</code>: The external nullifier at which the signal is
broadcast.</li></ul><p>To zk-SNARK proof must satisfy the constraints created by Semaphore&#x27;s zk-SNARK
circuit as described below:</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="the-zk-snark-circuit"></a>The zk-SNARK circuit<a class="hash-link" href="#the-zk-snark-circuit" title="Direct link to heading">#</a></h3><p>The
<a href="https://github.com/appliedzkp/semaphore/blob/master/circuits/circom/semaphore-base.circom" target="_blank" rel="noopener noreferrer">semaphore-base.circom</a>
circuit helps to prove the following:</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="that-the-identity-commitment-exists-in-the-merkle-tree"></a>That the identity commitment exists in the Merkle tree<a class="hash-link" href="#that-the-identity-commitment-exists-in-the-merkle-tree" title="Direct link to heading">#</a></h3><p><strong>Private inputs:</strong></p><ul><li><code>identity_pk</code>: the user&#x27;s EdDSA public key</li><li><code>identity_nullifier</code>: a random 32-byte value which the user should save</li><li><code>identity_trapdoor</code>: a random 32-byte value which the user should save</li><li><code>identity_path_elements</code>: the values along the Merkle path to the
user&#x27;s identity commitment</li><li><code>identity_path_index[n_levels]</code>: the direction (left/right) per tree level
corresponding to the Merkle path to the user&#x27;s identity commitment</li></ul><p><strong>Public inputs:</strong></p><ul><li><code>root</code>: The Merkle root of the identity tree</li></ul><p><strong>Procedure:</strong></p><p>The circuit hashes the public key, identity nullifier, and identity trapdoor to
generate an <strong>identity commitment</strong>. It then verifies the Merkle proof against
the Merkle root and the identity commitment.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="that-the-signal-was-only-broadcasted-once"></a>That the signal was only broadcasted once<a class="hash-link" href="#that-the-signal-was-only-broadcasted-once" title="Direct link to heading">#</a></h3><p><strong>Private inputs:</strong></p><ul><li><code>identity_nullifier</code>: as above</li><li><code>identity_path_index</code>: as above</li></ul><p><strong>Public inputs:</strong></p><ul><li><code>external_nullifier</code>: the 29-byte external nullifier - see above</li><li><code>nullifiers_hash</code>: the hash of the identity nullifier, external nullifier,
and Merkle path index (<code>identity_path_index</code>)</li></ul><p><strong>Procedure:</strong></p><p>The circuit hashes the given identity nullifier, external nullifier, and Merkle
path index, and checks that it matches the given nullifiers hash. Additionally,
the smart contract ensures that it has not previously seen this nullifiers
hash. This way, double-signalling is impossible.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="that-the-signal-was-truly-broadcasted-by-the-user-who-generated-the-proof"></a>That the signal was truly broadcasted by the user who generated the proof<a class="hash-link" href="#that-the-signal-was-truly-broadcasted-by-the-user-who-generated-the-proof" title="Direct link to heading">#</a></h3><p><strong>Private inputs:</strong></p><ul><li><code>identity_pk</code>: as above</li><li><code>auth_sig_r</code>: the <code>r</code> value of the signature of the signal</li><li><code>auth_sig_s</code>: the <code>s</code> value of the signature of the signal</li></ul><p><strong>Public inputs:</strong></p><ul><li><code>signal_hash</code>: the hash of the signal</li><li><code>external_nullifier</code>: the 29-byte external nullifier - see above</li></ul><p><strong>Procedure:</strong></p><p>The circuit hashes the signal hash and the external nullifier, and verifies
this output against the given public key and signature. This ensures the
authenticity of the signal and prevents front-running attacks.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="cryptographic-primitives"></a>Cryptographic primitives<a class="hash-link" href="#cryptographic-primitives" title="Direct link to heading">#</a></h2><p>Semaphore uses MiMC for the Merkle tree, Pedersen commmitments for the identity
commitments, Blake2 for the nullifiers hash, and EdDSA for the signature.</p><p>MiMC is a relatively new hash function. We use the recommended MiMC
construction from <a href="https://eprint.iacr.org/2016/492.pdf" target="_blank" rel="noopener noreferrer">Albrecht et al</a>, and
there is a prize to break MiMC at <a href="http://mimchash.org" target="_blank" rel="noopener noreferrer">http://mimchash.org</a>
which has not been claimed yet.</p><p>We have also implemented a version of Semaphore which uses the Poseidon hash
function for the Merkle tree and EdDSA signature verification. This may have
better security than MiMC, allows identity insertions to save about 20% gas,
and roughly halves the proving time. Note, however, that the Poseidon-related
circuits and EVM bytecode generator have not been audited, so use it with
caution. To use it, checkout the <code>feat/poseidon</code> branch of this repository.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/akinovak/semaphore-spec/edit/main/docs/howitworks.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/semaphore-spec/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Introduction</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/semaphore-spec/quickstart"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Quick start Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#inserting-identities" class="table-of-contents__link">Inserting identities</a></li><li><a href="#broadcasting-signals" class="table-of-contents__link">Broadcasting signals</a><ul><li><a href="#the-zk-snark-circuit" class="table-of-contents__link">The zk-SNARK circuit</a></li><li><a href="#that-the-identity-commitment-exists-in-the-merkle-tree" class="table-of-contents__link">That the identity commitment exists in the Merkle tree</a></li><li><a href="#that-the-signal-was-only-broadcasted-once" class="table-of-contents__link">That the signal was only broadcasted once</a></li><li><a href="#that-the-signal-was-truly-broadcasted-by-the-user-who-generated-the-proof" class="table-of-contents__link">That the signal was truly broadcasted by the user who generated the proof</a></li></ul></li><li><a href="#cryptographic-primitives" class="table-of-contents__link">Cryptographic primitives</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/semaphore-spec/">Introduction</a></li><li class="footer__item"><a class="footer__link-item" href="/semaphore-spec/references">References</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://medium.com/privacy-scaling-explorations" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Medium<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/PrivacyScaling" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/appliedzkp/semaphore" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Contracts<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/appliedzkp/libsemaphore" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>JS Library<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 Semaphore</div></div></div></footer></div>
<script src="/semaphore-spec/assets/js/runtime~main.87f30fe4.js"></script>
<script src="/semaphore-spec/assets/js/main.4ce3ad23.js"></script>
</body>
</html>